<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" type="text/css" href="style.css">
  <script src="https://code.jquery.com/jquery-latest.js"></script>
</head>
<body>

	<div id="header">
	<h1> Buy Original </h1>
	<a href="/dashboard_brands.html">Brands</a>
	<a href="/dashboard_stores.html">Stores</a>
	<a href="/dashboard_categories.html">Categories</a>	
	<a href="/dashboard_discounts.html">Discounts</a>
	<a href="/dashboard_business_users.html">Users</a>
	<a href="/dashboard_original_fake.html">Users</a>	
	</div>
	
	<div id="blankSection" >
	<p></p>
	<p></p>
	<p></p>
	</div>
	<div id="blackSection" >
	
	
	<form id="uploadForm" enctype="multipart/form-data"  action="/brands/v1/addverification"  method="post">
	
	<p>
	Brand Id: <input type="text" name="bId" value="" id="bId" placeholder="(Unique Namber)">
	</p>
	
	Title: 
	<p> 
	<textarea name="title" value="" id="title" rows="1" cols="100"></textarea> 
	</p>
	
	
	Short Description: 
	<p> 
	<textarea name="shortDesc" value="" id="shortDesc" rows="1" cols="150"></textarea> 
	</p>
	
	Small Image: 
	<p>
	<input type="file" name="smallImage" id="smallImage" accept="image/*" />
	</p>
	
	Long Description (Optional):
	<p> 
	<textarea name="longDesc" value="" id="longDesc" rows="4" cols="150" placeholder="(optional)"></textarea> 
	</p>
	
	Large Image (Optional):
	<p> 
	<input type="file" id="largeImage" name="largeImage" accept="image/*"> 
	</p>
	<p>
	<input style="background-color:lightgreen" type="submit"  value="        Add        " name="Add">
	</p>
	
	
	</form>

	<p></p>
	<p></p>
	<p></p>
	<p></p>
	<p></p>
	<p></p>
	<p></p>
	<p></p>
	
	<div id="divSpinner"><img src="images/spinner.gif"/></div>
	
	<div id="boList">
	<table id="myTable"></table>
	</div>
		

<script>
$( document ).ready(function() {
    console.log( "ready!" );
    populateTable();
});

$("#uploadForm").submit(function(event) {
      /* stop form from submitting normally */
      event.preventDefault();
      
       var bId = document.getElementById("bId").value;
       var shortDesc = document.getElementById("shortDesc").value;
       
       $(this).find(":input").filter(function(){ return !this.value; }).attr("disabled", "disabled");
       
       
       if (!isNumeric(bId))
   		  alert ("Brand Id must be numeric");
   	   else if (shortDesc.length == 0)
   		  alert ("ShortDesc can not be empty");
   	   else
      		this.submit();
       
});
        
$("#uploadForm").bind('ajax:complete', function() {
		console.log('ajax:complete');
    	window.location.replace('/dashboard_original_fake.html')
   }); 
 
        
function populateTable() {

    // Empty content string
    var tableContent = '<tr><td>BRAND ID</td><td>Short Description</td><td>Small Image</td><td>Long Description</td><td>Large Image</td></tr>';
    // jQuery AJAX call for JSON
    
    $.ajax({
    	    type: 'GET',
        	url: '/services/brands/v1/verifications',
        	dataType: 'JSON',
        	beforeSend: function (request)
            {
                document.getElementById("divSpinner").style.display = 'inline';
                request.setRequestHeader("token", "YnV5b3JpZ2luYWxicmFuZHNieWFzbGJla2hhcg==");
            },
            success: function(data) {
            
    			document.getElementById("divSpinner").style.display = 'none';
    		//	$('loader').hide();
        	// For each item in our JSON, add a table row and cells to the content string
    	    $.each(data, function(){
        	    tableContent += '<tr>';
            	tableContent += '<td>' + this.bId + '</td>';
            	tableContent += '<td>' + this.shortDesc + '</td>';
            	tableContent += '<td>' + '<a href=/images/verifications/'+this.smallImage +'> link </a>' + '</td>';
            	tableContent += '<td>' + this.longDesc + '</td>';
            	tableContent += '<td>' + '<a href=/images/verifications/'+this.largeImage +'> link </a>' + '</td>';
            	tableContent += '<td> <a href="#" onclick=deleteVerification("'+this._id+'");>delete</a></td>';
            	tableContent += '</tr>';         
        	});
        	document.getElementById("myTable").innerHTML= tableContent;
        	}

        // Inject the whole content string into our existing HTML table;
    });
};
  
function addVerification() {
    event.preventDefault();

    // Super basic validation - increase errorCount variable if any fields are blank
    var errorCount = 0;
  

    // If it is, compile all user info into one object
    var bId = document.getElementById("bId").value;
    var shortDesc = document.getElementById("shortDesc").value;
    var smallImagePath = document.getElementById("smallImage").value;
    var smallImage = document.getElementById("smallImage");
    var longDesc = document.getElementById("longDesc").value;
    var largeImagePath = document.getElementById("largeImage").value;
    var largeImage = document.getElementById("largeImage");
    
    var smallImageName = getFileName(smallImagePath);
    var largeImageName = getFileName(largeImagePath);
     
    if (!isNumeric(bId))
   		alert ("Brand Id must be numeric");
   	else if (shortDesc.length == 0)
   		alert ("ShortDesc can not be empty");
   	else {
    	var newVerification = {
        	'bId': bId,
        	'shortDesc': shortDesc,
        	'smallImage':smallImage,
        	'smallImagePath':smallImageName,
        	'longDesc':longDesc,
        	'largeImage':largeImage,
        	'largeImagePath':largeImageName,
    	}
    	
    	
    	var formData = new FormData();
    	formData.append("bId",bId);
    	formData.append("shortDesc",shortDesc);
    	formData.append("smallImage",smallImage.files[0]);
    	formData.append("smallImagePath",smallImageName);
    	formData.append("longDesc",longDesc);
    	
    	
    	// var formDataJson = JSON.stringify(formData).serializeArray();
    	
		// Use AJAX to post the object to our addstore service
    	$.ajax({
        	    type: 'POST',
           	    data: formData,
                url: '/services/brands/v1/addverification',
                dataType: 'JSON',
            	beforeSend: function (request)
            	{
                	document.getElementById("divSpinner").style.display = 'inline';
                	request.setRequestHeader("token", "YnV5b3JpZ2luYWxicmFuZHNieWFzbGJla2hhcg==");
            	},
    	}).done(function( response ) {
		
			document.getElementById("divSpinner").style.display = 'none';
    		// Check for successful (blank) response
    		if (response.msg === '') {
    			document.getElementById("bId").value = "";
    			document.getElementById("shortDesc").value="";
    			document.getElementById("smallImage").value="";
    			document.getElementById("longDesc").value="";
         		document.getElementById("largeImage").value="";
         		// Update the table
        		//	populateTable();
			}
    		else {
				// If something goes wrong, alert the error message that our service returned
        		alert('Error: ' + response.msg);
    		}
    	})
    }
};

function deleteVerification(rowId) {

    event.preventDefault();

    // Pop up a confirmation dialog
    var confirmation = confirm('Are you sure you want to delete this category?');

    // Check and make sure the user confirmed
    if (confirmation === true) {

        // If they did, do our delete
        $.ajax({
            type: 'DELETE',
            url: '/services/brands/v1/deleteVerification/' + rowId,
            beforeSend: function (request)
        	{
            	document.getElementById("divSpinner").style.display = 'inline';
            	request.setRequestHeader("token", "YnV5b3JpZ2luYWxicmFuZHNieWFzbGJla2hhcg==");
        	},
        }).done(function( response ) {
			
			document.getElementById("divSpinner").style.display = 'none';
            // Check for a successful (blank) response
            if (response.msg === '') {
            }
            else {
                alert('Error: ' + response.msg);
            }

            // Update the table
            populateTable();

        })

    }
    else {

        // If they said no to the confirm, do nothing
        return false;

    }

};

function isNumeric(n) {
  return !isNaN(parseFloat(n)) && isFinite(n);
}
     
function getFileName(path) {
	if (path) {
		var startIndex = (path.indexOf('\\') >= 0 ? path.lastIndexOf('\\') : path.lastIndexOf('/'));
		var filename = path.substring(startIndex);
		if (filename.indexOf('\\') === 0 || filename.indexOf('/') === 0) {
			filename = filename.substring(1);
		}	
		return filename;
	}
	else {
		return "";
	}
}   
                
</script>
</body>
</html>